<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>kubernetes部署笔记 | 熊吉的博客小站</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">kubernetes部署笔记</h1><a id="logo" href="/.">熊吉的博客小站</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">kubernetes部署笔记</h1><div class="post-meta">Sep 16, 2018</div><div class="post-content"><h4 id="安装kubernetes步骤"><a href="#安装kubernetes步骤" class="headerlink" title="安装kubernetes步骤"></a>安装kubernetes步骤</h4><h4 id="一、系统初始化"><a href="#一、系统初始化" class="headerlink" title="一、系统初始化"></a>一、系统初始化</h4><p>系统初始化分为几个部分，第一个部分是执行初始化脚本，关闭防火墙，关闭selinux<br>第二个部分是关闭swap，这是k8s的需求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a &amp;&amp; sed -i <span class="string">'/swap/d'</span> /etc/fstab</span><br></pre></td></tr></table></figure>

<h4 id="二、安装docker服务"><a href="#二、安装docker服务" class="headerlink" title="二、安装docker服务"></a>二、安装docker服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行脚本直接安装docker-ce 使用阿里源</span></span><br><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line"><span class="comment"># 添加用户无需root直接执行docker</span></span><br><span class="line">sudo usermod -aG docker server</span><br><span class="line"><span class="comment"># 开启docker开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># 开启docker服务</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h4 id="三、安装kubernetes服务"><a href="#三、安装kubernetes服务" class="headerlink" title="三、安装kubernetes服务"></a>三、安装kubernetes服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先配置安装源，安装kubernetes</span></span><br><span class="line"><span class="comment">### 如果是Debian / Ubuntu执行以下</span></span><br><span class="line">Debian / Ubuntu</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF  </span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment">### 如果是CentOS / RHEL / Fedora执行以下</span></span><br><span class="line">CentOS / RHEL / Fedora</span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">setenforce 0</span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure>

<h4 id="四、kubernetes初始化"><a href="#四、kubernetes初始化" class="headerlink" title="四、kubernetes初始化"></a>四、kubernetes初始化</h4><p>直接执行systemctl start kubelet是并不能正确启动的，需要进行初始化<br>因为初始化需要镜像，可以执行以下脚本进行初始化镜像国内源下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">images=(</span><br><span class="line">    kube-apiserver:v1.13.3</span><br><span class="line">    kube-controller-manager:v1.13.3</span><br><span class="line">    kube-scheduler:v1.13.3</span><br><span class="line">    kube-proxy:v1.13.3</span><br><span class="line">    pause:3.1</span><br><span class="line">    etcd:3.2.24</span><br><span class="line">    coredns:1.2.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    pause-amd64:3.1</span><br><span class="line"></span><br><span class="line">    kubernetes-dashboard-amd64:v1.10.0</span><br><span class="line">    heapster-amd64:v1.5.4</span><br><span class="line">    heapster-grafana-amd64:v5.0.4</span><br><span class="line">    heapster-influxdb-amd64:v1.5.2</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> imageName <span class="keyword">in</span> <span class="variable">$&#123;images[@]&#125;</span> ; <span class="keyword">do</span></span><br><span class="line">    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="variable">$imageName</span></span><br><span class="line">    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="variable">$imageName</span> k8s.gcr.io/<span class="variable">$imageName</span></span><br><span class="line">    docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="variable">$imageName</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>把脚本保存到本地进行相应修改并执行，下载镜像。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubernetes初始化，注意需要开代理从google下载镜像</span></span><br><span class="line">kubeadm init --pod-network-cidr=10.244.0.0/16</span><br><span class="line"><span class="comment"># kubernetes启动</span></span><br><span class="line">systemctl start kubelet</span><br></pre></td></tr></table></figure>

<h4 id="五、kubernetes加入节点"><a href="#五、kubernetes加入节点" class="headerlink" title="五、kubernetes加入节点"></a>五、kubernetes加入节点</h4><p>通过kubeadm初始化后，都会提供node加入的token。<br>默认token的有效期为24小时，当过期以后，该token就不可用了，解决方法如下：<br>重新生成新的token</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master server]<span class="comment"># kubeadm token create</span></span><br><span class="line">je5176.gdhi2d95q4edcg3n</span><br><span class="line">[root@master server]<span class="comment"># kubeadm token list</span></span><br><span class="line">TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS</span><br><span class="line">c9owsq.7bpfx7mbfnhd7e20   5h        2018-09-20T23:48:15+08:00   authentication,signing   The default bootstrap token generated by <span class="string">'kubeadm init'</span>.   system:bootstrappers:kubeadm:default-node-token</span><br><span class="line"></span><br><span class="line">je5176.gdhi2d95q4edcg3n   23h       2018-09-21T18:19:16+08:00   authentication,signing   &lt;none&gt;    system:bootstrappers:kubeadm:default-node-token</span><br></pre></td></tr></table></figure>

<p>获取ca证书sha256编码hash值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master server]<span class="comment"># openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'</span></span><br><span class="line">84ac067eebeed57154fc6f03ad0e3d10a1076f2fe268077c11e00787d3689327</span><br></pre></td></tr></table></figure>

<p>节点加入集群</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.239.137:6443  --token je5176.gdhi2d95q4edcg3n --discovery-token-ca-cert-hash sha256:84ac067eebeed57154fc6f03ad0e3d10a1076f2fe268077c11e00787d3689327</span><br></pre></td></tr></table></figure>

<h4 id="六、CNI网络插件加入"><a href="#六、CNI网络插件加入" class="headerlink" title="六、CNI网络插件加入"></a>六、CNI网络插件加入</h4><p>通过CNI插件进行部署，如安装flannel插件。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/coreos/</span>flannel<span class="regexp">/bc79dd1505b0c8681ece4de4c0d86c5cd2643275/</span>Documentation<span class="regexp">/kube-flannel.yml</span></span><br></pre></td></tr></table></figure>

<h4 id="七、拷贝kubectl-配置进行管理"><a href="#七、拷贝kubectl-配置进行管理" class="headerlink" title="七、拷贝kubectl 配置进行管理"></a>七、拷贝kubectl 配置进行管理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/admin.conf</span><br><span class="line"><span class="built_in">export</span> KUBECONFIG=<span class="variable">$HOME</span>/admin.conf</span><br></pre></td></tr></table></figure>

<h4 id="六、加入服务进行管理"><a href="#六、加入服务进行管理" class="headerlink" title="六、加入服务进行管理"></a>六、加入服务进行管理</h4><p>1、创建实例yaml文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">mariadb:latest</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">3386</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">          - name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line"><span class="attr">            value:</span> <span class="string">"123456"</span></span><br></pre></td></tr></table></figure>

<p>执行创建rc命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[server@lq-docker-test0 examples]$ kubectl create -f mysql-rc.yaml</span><br><span class="line">replicationcontroller/mysql created</span><br></pre></td></tr></table></figure>

<p>查看执行效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[server@lq-docker-test0 examples]$ kubectl get rc</span><br><span class="line">NAME      DESIRED   CURRENT   READY     AGE</span><br><span class="line">mysql     1         1         0         5s</span><br><span class="line">[server@lq-docker-test0 examples]$ kubectl get pods</span><br><span class="line">NAME          READY     STATUS    RESTARTS   AGE</span><br><span class="line">mysql-r2p6w   0/1       Pending   0          58s</span><br></pre></td></tr></table></figure>

<p>执行describe命令查看没有创建成功的原因。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[server@lq-docker-test0 examples]$ kubectl describe pods mysql-r2p6w</span><br><span class="line">Name:           mysql-r2p6w</span><br><span class="line">Namespace:      default</span><br><span class="line">Node:           &lt;none&gt;</span><br><span class="line">Labels:         app=mysql</span><br><span class="line">Annotations:    &lt;none&gt;</span><br><span class="line">Status:         Pending</span><br><span class="line">IP:</span><br><span class="line">Controlled By:  ReplicationController/mysql</span><br><span class="line">Containers:</span><br><span class="line">  mysql:</span><br><span class="line">    Image:      mariadb:latest</span><br><span class="line">    Port:       3386/TCP</span><br><span class="line">    Host Port:  0/TCP</span><br><span class="line">    Environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD:  123456</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-cgbn8 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status</span><br><span class="line">  PodScheduled   False</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-cgbn8:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-cgbn8</span><br><span class="line">    Optional:    <span class="literal">false</span></span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age               From               Message</span><br><span class="line">  ----     ------            ----              ----               -------</span><br><span class="line">  Warning  FailedScheduling  1s (x15 over 2m)  default-scheduler  0/1 nodes are available: 1 node(s) had taints that the pod didn<span class="string">'t tolerate.</span></span><br></pre></td></tr></table></figure>

<p>问题原因是因为master节点默认不运行其他任务，我们手动执行配置一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[server@lq-docker-test0 examples]$ kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line">node/lq-docker-test0 untainted</span><br></pre></td></tr></table></figure>

<p>然后查看运行效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[server@lq-docker-test0 examples]$ kubectl describe pods mysql-r2p6w</span><br><span class="line">Name:           mysql-r2p6w</span><br><span class="line">Namespace:      default</span><br><span class="line">Node:           lq-docker-test0/192.168.5.4</span><br><span class="line">Start Time:     Thu, 27 Sep 2018 18:02:02 +0800</span><br><span class="line">Labels:         app=mysql</span><br><span class="line">Annotations:    &lt;none&gt;</span><br><span class="line">Status:         Pending</span><br><span class="line">IP:</span><br><span class="line">Controlled By:  ReplicationController/mysql</span><br><span class="line">Containers:</span><br><span class="line">  mysql:</span><br><span class="line">    Container ID:</span><br><span class="line">    Image:          mariadb:latest</span><br><span class="line">    Image ID:</span><br><span class="line">    Port:           3386/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Waiting</span><br><span class="line">      Reason:       ContainerCreating</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD:  123456</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-cgbn8 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             False</span><br><span class="line">  ContainersReady   False</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-cgbn8:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-cgbn8</span><br><span class="line">    Optional:    <span class="literal">false</span></span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                From                      Message</span><br><span class="line">  ----     ------            ----               ----                      -------</span><br><span class="line">  Warning  FailedScheduling  19s (x24 over 3m)  default-scheduler         0/1 nodes are available: 1 node(s) had taints that the pod didn<span class="string">'t tolerate.</span></span><br><span class="line"><span class="string">  Normal   Scheduled         12s                default-scheduler         Successfully assigned default/mysql-r2p6w to lq-docker-test0</span></span><br><span class="line"><span class="string">  Normal   Pulling           11s                kubelet, lq-docker-test0  pulling image "mariadb:latest"</span></span><br></pre></td></tr></table></figure>

<h4 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h4><p>安装过程中出现过几次问题，我记录如下</p>
<h4 id="一、k8s-dns-ipv6问题"><a href="#一、k8s-dns-ipv6问题" class="headerlink" title="一、k8s-dns ipv6问题"></a>一、k8s-dns ipv6问题</h4><p>k8s需要网卡配置ipv6才能正常启动k8s-dns，如果出现k8s-dns找不到ipv6相关配置，需要排查解决一下此问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifconfig -a | grep inet6</span></span><br><span class="line">        inet6 fe80::211:aff:fe6a:9de4  prefixlen 64  scopeid 0x20</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10[host]</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/iiiiher/p/8159693.html" target="_blank" rel="noopener">[k8s]k8s 1.9(on the fly搭建) 1.9_cni-flannel部署排错 ipvs模式</a><br><a href="https://www.thegeekdiary.com/centos-rhel-7-how-to-disable-ipv6/" target="_blank" rel="noopener">How to disable IPv6 on CentOS / RHEL 7</a></p>
<h4 id="二、k8s-master调度问题"><a href="#二、k8s-master调度问题" class="headerlink" title="二、k8s master调度问题"></a>二、k8s master调度问题</h4><p>k8s默认不在主节点上运行容器任务，需要手动执行命令后，才在master节点上执行任务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl taint nodes --all node-role.kubernetes.io/master-</span><br></pre></td></tr></table></figure>

<p><a href="http://blog.51cto.com/xudate/2150607" target="_blank" rel="noopener">kubernetes遇到问题</a><br><a href="https://github.com/rootsongjc/kubernetes.github.io/blob/master/docs/setup/independent/create-cluster-kubeadm.md" target="_blank" rel="noopener">如何安装Kubernetes 集群</a></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/09/30/青云对象存储挂载到Linux主机/">青云对象存储挂载到Linux主机</a><a class="next" href="/2018/09/06/zabbix监控部署汇总/">zabbix监控部署汇总</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://luckyops.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/01/k8s给域名创建https证书/">k8s给域名创建https证书</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/08/算法图解的代码实现/">算法图解的代码实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/饮品调配单/">饮品调配单</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/18/Linux防火墙读书笔记/">Linux防火墙读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/07/漫谈我对Linux监控软件的理解/">漫谈我对Linux监控软件的理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/08/rap2&YApi api文档部署/">rap2&YApi api文档部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/19/openresty配置request&respone输出到log/">openresty配置request&respone输出到log</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/23/openresty-install-vts-md/">openresty_install_vts.md</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/10/Helm部署和配置/">Helm部署和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/20/基于GlustFS的CetnOS持久化存储/">基于GlustFS的CetnOS持久化存储</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">熊吉的博客小站.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>